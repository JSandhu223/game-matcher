@page "/"
@rendermode InteractiveServer
@inject IHttpClientFactory ClientFactory
@inject IConfiguration Configuration
@inject SteamService SteamService


<PageTitle>Home</PageTitle>

<h1>Welcome to the Steam Game Matcher</h1>

<p>Find games that you share in common with your Steam friends!</p>

@* <Counter IncrementAmount="10" /> *@

@* <div>
	<button @onclick="GetPlaceholderJSON">Get Placeholder JSON</button>
	<p>@responseResult</p>
</div> *@

<div>
	<input @bind="lookupID" placeholder="Enter your steam ID" />
	<button @onclick="GetSteamUser">Load Player</button>
	<button @onclick="GetFriends">Load Friend List</button>
</div>

<p>lookupID = @lookupID</p>

@if (player != null)
{
	<p>Name: @player.PersonaName</p>
	<img src="@player.AvatarFull" />
}

@if (friend != null)
{
	<h3>First Steam Friend Result</h3>
	<p>Friend Steam ID: @friend.SteamId</p>
	<p>Relationship: @friend.Relationship</p>
	<p>Friend Since: @friend.FriendSince</p>
}
else
{
	<p>Friend is null</p>
}

@code {
	string responseResult = "Click the button above";

	string lookupID = string.Empty;

	PlayerSummary? player;

	Friend? friend;

	private async Task GetPlaceholderJSON(MouseEventArgs args)
	{
		// The HTTP GET request we will send to the API endpoint
		using var request = new HttpRequestMessage(HttpMethod.Get,
			"https://jsonplaceholder.typicode.com/todos/1");

		// The client is used for sending HTTP requests and receiving HTTP responses from a resource identified by a URI
		var client = ClientFactory.CreateClient();

		// Send the HTTP request and get the response
		using var response = await client.SendAsync(request);

		if (response.IsSuccessStatusCode)
		{
			var responseStream = await response.Content.ReadAsStringAsync();
			responseResult = responseStream;

		}
		else
		{
			responseResult = $"Request failed with status code: {response.StatusCode.ToString()}";
		}
	}

	private async Task GetSteamUser(MouseEventArgs args)
	{
		player = await SteamService.GetPlayerSummaryAsync("76561198063946970");
	}

	private async Task GetFriends(MouseEventArgs args)
	{
		friend = await SteamService.GetFriendListAsync("76561198063946970");
	}
}
